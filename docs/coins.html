<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Art Store — Монеты</title>
<link rel="stylesheet" href="static/css/style.css">
</head>
<body>

<header class="site-header">
  <a class="brand" href="index.html">Art Store</a>
  <nav class="main-nav">
    <a href="index.html">Главная</a>
    <div class="dropdown">
      <a href="#">Магазин</a>
      <div class="dropdown-content">
        <a href="paintings.html">Картины</a>
        <a href="sculptures.html">Скульптуры</a>
        <a href="rarities.html">Раритет</a>
        <a href="coins.html">Монеты</a>
      </div>
    </div>
    <a href="cart.html">Корзина <span class="badge" id="cart-count">0</span></a>
    <a href="contact.html">Контакты</a>
  </nav>
</header>

<main class="container">
  <h1>Монеты</h1>
  <p>Коллекционные монеты со всего мира.</p>

  <div class="sections" id="coins-list">
    <!-- сюда загрузятся товары из Firestore -->
  </div>
</main>

<div class="site-footer-wrapper">
  <footer class="site-footer">© 2025 Art Store — Corporation VA</footer>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ===== Firebase =====
  const firebaseConfig = {
    apiKey: "AIzaSyDgymi8tGWcLsowq8cPYZUcG3xCk2CbG2E",
    authDomain: "artstore-e9610.firebaseapp.com",
    projectId: "artstore-e9610",
    storageBucket: "artstore-e9610.appspot.com",
    messagingSenderId: "116819253020",
    appId: "1:116819253020:web:a4860eb14a7beef637ccd9"
  };
  if (!firebase.apps || !firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  } else {
    try { firebase.app(); } catch(e) { firebase.initializeApp(firebaseConfig); }
  }
  const db = firebase.firestore();

  const listEl = document.getElementById('coins-list');

  async function loadCoins() {
    try {
      const snap = await db.collection("products")
                           .where("category", "==", "coins")
                           .get();

      listEl.innerHTML = "";

      if (snap.empty) {
        listEl.innerHTML = '<p style="text-align:center;color:#666;">Пока нет товаров в этой категории.</p>';
        return;
      }

      snap.forEach(doc => {
        const p = doc.data();
        const card = document.createElement('div');
        card.className = 'section-card';
        card.innerHTML = `
          <img src="${p.imageURL || 'img/placeholder.png'}" alt="${p.name || 'Товар'}">
          <h2>${p.name || 'Без названия'}</h2>
          <p>${p.description || ''}</p>
          ${p.price ? `<p><strong>Цена: ${p.price}€</strong></p>` : ''}
          <button class="qty-btn" onclick="addToCart('${doc.id}')">Добавить в корзину</button>
        `;
        listEl.appendChild(card);
      });
    } catch (e) {
      console.error("Ошибка загрузки монет:", e);
      listEl.innerHTML = '<p style="text-align:center;color:#c00;">Ошибка загрузки товаров.</p>';
    }
  }

  // ===== Корзина =====
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart') || '{}');
    const total = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
    const badge = document.getElementById('cart-count');
    if (badge) badge.textContent = total;
  }

  function addToCart(itemId) {
    const cart = JSON.parse(localStorage.getItem('cart') || '{}');
    cart[itemId] = (cart[itemId] || 0) + 1;
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
  }

  // Инициализация
  updateCartCount();
  loadCoins();
</script>

</body>
</html>